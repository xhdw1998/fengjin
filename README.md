# fengjin
## 护网行动联动封禁系统
### Elk程序
Elk通过获取ES数据库中的高危事件数据，将它们首先进行IP白名单过滤之后将这些过滤后的数据记录到每天产生的CSV日志文件，之后再将这些高危事件的IP提取出来进行筛选去重后读取Ban.txt中的IP进行对比再次去重后将筛选后的IP写入Ban.txt,接着将筛选后的IP发送到封禁函数即实现六台设备同时封禁目标IP,最后程序将封禁成功/失败的信息写入到elk.log进行日志记录。整个函数体每2分钟运行一次
Elk程序通过获取高危事件, 第一时间联动六台eds设备进行封禁做到了有危必封的功能。


### FK01程序
FK01系统 获取六台EDS设备上的封禁数据和FK01最近7天内的高危攻击信息将这些信息传送到日志易,再将这两对数据IP信息进行逐个对比如果存在则打印已经被封禁，如果不存在则将封禁IP传入到封禁的函数，函数将IP通过API发送到EDS进行封禁再将数据写入到Ban.txt 每30分钟循环运行一次
FK01作用是不漏过一个外网高威胁攻击,与elk封禁数据进行对比封禁大大提高了网络安全防御

#### Web封禁系统
Web封禁系统是通过php+mysql进行开发实现了 封、查、解 三大功能
#### 封禁IP页面
封禁IP数据分页:此功能是通过API读取EDS其中一台设备的IP信息进行数据分页 展示了被封禁IP的一些信息
单个封禁IP:此功能直接调用配合web前端输入ip信息传送到API中调用即可进行单个IP进行封禁 
批量IP封禁:此功能是配合web前端输入,后端进行数组分割for循环批量执行单个封禁达到批量封禁的目的
#### 搜索/删除封禁页面
	进入到此页面首先进行数据判断将eds中的总数据与数据库表对比如果有多的数据 立即更新数据库表中的数据，保持eds设备与数据库中的数据一致。
	IP单个搜索/解封:直接在数据库中搜索IP如果存在则打印出来,同时查6个数据表进行反馈。解封通过查询6个表数据库的DbId和eds对应起来 对应成功则进行删除eds中的IP。
	按时间批量查询IP:通过输入开始时间和结束时间传输给两个变量进行数据库查询同时查六张表进行数据反馈。
	按时间批量解封:解封通过查询6个表数据库的DbId和eds对应起来 对应成功则进行删除eds中的IP。
	批量IP查询:通过web前端接收一堆数据后台进行拆分整合成数组,进行数据库查询反馈
	批量IP解封:先查目标IP的DbId再将DbId传入到eds设备中进行批量IP解封
#### 分组管理页面
	新增分组:前端输入后端存取到数据库
	删除分组:前端删除后端响应到数据库执行删除
	修改分组:前端修改后端响应到数据库执行修改
	
在WAF监测时流量时总会遇到中危流量，而大部分攻击蕴含在中危告警中 但中危告警中又包含了很多的正常请求这就需要我们人工去分析研判来确定是不是攻击 如果是则就需要用到我们的web封禁系统直接填入IP点击封禁 即可进行封禁。在HW行动中遇到大量攻击对IP情报可以将这些情报直接copy到我们的封禁系统一键进行批量封禁。如果因为人工误判封错IP我们可以使用IP封禁系统查询此IP是否被我们封禁、是谁封的、封的时间等一系列信息可迅速点击一键解封即可完成六台EDS设备同时解封。HW结束或其他网络安全攻防结束可进行时间段查询IP 一键解封HW时间段的IP。
